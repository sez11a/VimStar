return {
	"nvimtools/none-ls.nvim",
	config = function()
		local null_ls = require("null-ls")

		null_ls.setup({
			sources = {
				null_ls.builtins.formatting.stylua,
				null_ls.builtins.formatting.prettier,
				null_ls.builtins.diagnostics.erb_lint,
				null_ls.builtins.diagnostics.rubocop,
				null_ls.builtins.diagnostics.vale.with({
					-- 1. Define the project root based on the file existence
					root_pattern = ".vale.ini",

					-- 2. Explicitly define the command line arguments to use the found root.
					-- 'opts.root' will be the directory containing .vale.ini (or nil if not found).
					args = function(opts)
                        -- If opts.root is nil, none-ls will effectively skip running the command,
                        -- but we should ensure the args are correct if a root is found.
                        if opts.root then
                            return {
                                "--config",
                                opts.root .. "/.vale.ini",
                                "--input",
                                opts.bufname,
                            }
                        end
                        -- Return nil or empty table if no root is found to prevent execution
                        return {}
					end,

                    -- 3. (Optional but recommended) Include the explicit condition check from before.
                    condition = function(opts)
						return opts.root ~= nil
					end,
				}),
			},
		})

		vim.keymap.set("n", "<leader>gf", vim.lsp.buf.format, {})
	end,
}
-- return {
-- 	"nvimtools/none-ls.nvim",
-- 	config = function()
-- 		local null_ls = require("null-ls")
-- 		null_ls.setup({
-- 			sources = {
-- 				null_ls.builtins.formatting.stylua,
-- 				null_ls.builtins.formatting.prettier,
-- 				null_ls.builtins.diagnostics.erb_lint,
-- 				null_ls.builtins.diagnostics.rubocop,
--         null_ls.builtins.diagnostics.vale.with{
--           -- Use Vale only with .vale.ini present
--           condition = function()
--             return require"null-ls.utils".root_pattern(
--               ".vale.ini"
--             )(vim.api.nvim_buf_get_name(0)) ~= nil
--           end,
--         },
-- 			},
-- 		})

-- 		vim.keymap.set("n", "<leader>gf", vim.lsp.buf.format, {})
-- 	end,
-- }
